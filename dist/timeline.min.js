/**
 * mobile-timeline - A timeline focused on a mobile-first strategy (i.e. vertical)
 * @version v0.0.1
 * @link https://github.com/datanews/mobile-timeline
 * @license MIT
 */
"use strict";!function(e,t){"undefined"!=typeof module&&module.exports&&"function"==typeof require?module.exports=t(require("underscore"),require("moment")):"function"==typeof define&&define.amd?define(["underscore","moment"],t):e.Timeline=t(e._,e.moment)}("undefined"!=typeof window?window:this,function(e,t){if("undefined"==typeof e)throw new Error("Underscore is a necessary dependency of Timeline.");if("undefined"==typeof t)throw new Error("Moment is a necessary dependency of Timeline.");var i={dateFormats:["MMM DD, YYYY","MM/DD/YYYY","M/D/YYYY","DD MMM YYYY","YYYY-MM-DD"],displayFormat:"MMM DD, YYYY",template:'<div class="timeline-container">  <% _.forEach(groups, function(g, gi) { %>  <div class="group">  <div class="group-label">  <%= g.id %>  </div>   <div class="group-events">  <% _.forEach(g.events, function(e, ei) { %>  <div class="event">  <div class="event-date"><%= e.dateFormatted %></div>   <% if (e.title) { %>  <h3 class="event-title"><%= e.title %></h3>  <% } %>   <div class="event-content-container cf">  <% if (e.media) { %>  <div class="event-media-container <% if (e.body) { %>with-body<% } %>">  <div class="event-media <% if (e.source) { %>with-source<% } %>">  <img src="<%= e.media %>">  </div>   <% if (e.source) { %>  <div class="event-source">  <%= e.source %>  </div>  <% } %>  </div>  <% } %>   <% if (e.body) { %>  <div class="event-body-container <% if (e.media) { %>with-media<% } %>">  <div class="event-body"><%= e.body %></div>  </div>  <% } %>  </div>  </div>  <% }) %>  </div>  </div>  <% }) %> </div> '},n=function(t){if(this.options=e.extend({},i,t||{}),!e.isArray(this.options.events))throw new Error('"events" data was not provided as an array.');if(this.options.keyMapping&&!e.isObject(this.options.keyMapping))throw new Error('"keyMapping" was not provided as an object.');if(!e.isString(this.options.template)&&!e.isFunction(this.options.template))throw new Error('"template" was not provided as a string or function.');if(e.isString(this.options.template))try{this.options.template=e.template(this.options.template)}catch(n){throw new Error("Error parsing template string with underscore templating: "+n.message)}if(this.isBrowser=this.checkBrowser(),this.isBrowser&&!this.options.el)throw new Error('"el" needs to br provided as a string or object.');if(this.el=this.getElement(this.options.el),this.isBrowser&&!this.el)throw new Error('Could not find a valid element from the given "el" option.');this.events=this.mapKeys(this.options.events,this.options.keyMapping),this.events=this.parseEvents(this.events),this.groups=this.groupEvents(this.events),this.groups=this.sortGroups(this.groups),this.isBrowser&&this.render()};return e.extend(n.prototype,{render:function(){this.el.innerHTML=this.options.template({_:e,groups:this.groups,timeline:this})},getElement:function(e){var t;return this.isBrowser&&e?e.nodeType?e:"string"==typeof e&&(t=document.getElementById(e),!t&&document.querySelector&&(t=document.querySelector(e)),t&&t.nodeType)?t:e[0]&&e[0].nodeType?e[0]:null:null},checkBrowser:function(){return"undefined"!=typeof window&&document},sortGroups:function(t){return t=e.map(t,function(t){return t.events=e.sortBy(t.events,function(e){return e.date.unix()}),t}),e.sortBy(t,function(e){return e.date.unix()})},groupEvents:function(i){var n,r={};return this.groupType=this.determineGroups(this.events),n="groupBy"+this.groupType.charAt(0).toUpperCase()+this.groupType.slice(1),n=this[n],e.each(i,function(i){var o=e.bind(n,this)(i,t);r[o.id]?r[o.id].events.push(i):(r[o.id]=o,r[o.id].events=[i])}),e.values(r)},groupByMonths:function(e,t){return{id:e.date.format("YYYY-MM"),date:t(e.date.format("YYYY-MM"),"YYYY-MM")}},groupByYears:function(e,t){return{id:e.date.format("YYYY"),date:t(e.date.format("YYYY"),"YYYY")}},groupByDecades:function(e,t){var i=10*Math.floor(e.date.year()/10);return{id:i.toString(),date:t(i.toString(),"YYYY")}},determineGroups:function(t){var i=function(e){return e.date.unix()},n=e.min(t,i),r=e.max(t,i),o=r.date.diff(n.date,"years");return 2>o?"months":10>o?"years":"decades"},parseEvents:function(i){return e.map(i,e.bind(function(e){var i=t(e.date,this.options.dateFormats);if(!i.isValid())throw new Error('Error parsing date from "'+e.date+'"');return e.date=i,e.dateFormatted=i.format(this.options.displayFormat),e},this))},mapKeys:function(t,i){return i=i||{},e.map(t,function(t){var n=e.clone(t);return e.each(i,function(i,r){e.isUndefined(t[i])||i===r||(n[r]=e.clone(t[i]),delete n[i])}),n})}}),n});